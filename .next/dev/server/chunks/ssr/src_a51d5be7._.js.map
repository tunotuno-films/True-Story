{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/tunotunofilms/Downloads/code/True%20Story/src/components/PrivacyPolicy.tsx"],"sourcesContent":["import React from 'react';\n\ninterface PrivacyPolicyProps {\n  onClose: () => void;\n}\n\nconst PrivacyPolicy: React.FC<PrivacyPolicyProps> = ({ onClose }) => {\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-95 z-[100] p-4 sm:p-8 md:p-12 overflow-y-auto\">\n      <div className=\"container mx-auto max-w-4xl text-neutral-300 font-noto text-xs md:text-sm\">\n        <div className=\"flex justify-between items-center mb-8\">\n          <h1 className=\"text-2xl md:text-3xl font-bold text-white\">個人情報保護（プライバシーポリシー）</h1>\n          <button onClick={onClose} className=\"text-gray-400 hover:text-white text-3xl\">&times;</button>\n        </div>\n        <div className=\"space-y-4 md:space-y-6 leading-relaxed\">\n\n          <p>\n            True Story【実話の物語】（以下「当社」といいます）は、制作活動および会員サービス（会員マイページを含む）を提供する上で\n            取扱うお客様・お取引先様・従業員等の個人情報を適切に保護することを社会的責務と認識し、以下の方針に基づき個人情報の保護に努めます。\n          </p>\n\n          <section>\n            <h2 className=\"text-xl font-semibold text-white mb-2\">1. 個人情報の定義</h2>\n            <p>\n              本方針において「個人情報」とは、個人情報保護法に定められた定義に従い、氏名、生年月日、住所、電話番号、メールアドレス、\n              勤務先、ログインID、パスワード、利用履歴その他特定の個人を識別できるもの、ならびに他の情報と照合することで個人を識別できるものを指します。\n            </p>\n          </section>\n\n          <section>\n            <h2 className=\"text-xl font-semibold text-white mb-2\">2. 個人情報の取得方法</h2>\n            <p>\n              当社は、以下の方法で個人情報を取得します。\n            </p>\n            <ul className=\"list-disc list-inside ml-4 mt-2 space-y-1\">\n              <li>会員登録フォームや会員マイページでの入力</li>\n              <li>ウェブサイトやメールフォーム、電話、書面等を通じた直接取得</li>\n              <li>イベント、セミナー、アンケート等での取得</li>\n              <li>業務委託先や取引先等から適法に提供を受けた場合</li>\n              <li>公表された情報から適法に収集する場合</li>\n            </ul>\n            <p className=\"mt-2\">取得の際には、利用目的を明確にし、適法かつ公正な手段で行います。</p>\n          </section>\n\n          <section>\n            <h2 className=\"text-xl font-semibold text-white mb-2\">3. 個人情報の利用目的</h2>\n            <p>当社は、取得した個人情報を以下の目的で利用します。</p>\n            <ul className=\"list-disc list-inside ml-4 mt-2 space-y-1\">\n              <li>サービスや商品の提供および契約履行</li>\n              <li>会員登録、本人認証、会員マイページ機能の提供・管理</li>\n              <li>会員向けサービス（履歴表示、ポイント、カスタマイズ機能等）の運営</li>\n              <li>退会手続きおよび退会後の記録管理</li>\n              <li>お問い合わせやご依頼への対応</li>\n              <li>契約、取引、請求、支払い等の事務処理</li>\n              <li>メールマガジン、ニュースレター、イベント案内等の送付</li>\n              <li>アンケート調査、モニター募集等の実施</li>\n              <li>法令や契約に基づく権利の行使または義務の履行</li>\n              <li>防犯・安全管理のための記録・監視</li>\n              <li>その他、事前に本人の同意を得た目的</li>\n            </ul>\n          </section>\n\n          <section>\n            <h2 className=\"text-xl font-semibold text-white mb-2\">4. 個人情報の第三者提供</h2>\n            <p>\n              当社は、以下の場合を除き、本人の同意なく第三者に個人情報を提供しません。\n            </p>\n            <ul className=\"list-disc list-inside ml-4 mt-2 space-y-1\">\n              <li>法令に基づく場合</li>\n              <li>人の生命、身体または財産の保護のために必要で、本人の同意を得ることが困難な場合</li>\n              <li>公衆衛生の向上または児童の健全な育成推進のために特に必要な場合で、本人の同意を得ることが困難な場合</li>\n              <li>国の機関や地方公共団体等が法令の定める事務を遂行するために協力する必要がある場合</li>\n              <li>業務委託先に必要な範囲で提供する場合（委託先は適切に監督します）</li>\n            </ul>\n          </section>\n\n          <section>\n            <h2 className=\"text-xl font-semibold text-white mb-2\">5. 個人情報の委託</h2>\n            <p>\n              当社は、事業運営に必要な範囲で業務を外部に委託する場合、委託先が個人情報を適切に取り扱うよう契約等により義務付け、\n              必要かつ適切な監督を行います。\n            </p>\n          </section>\n\n          <section>\n            <h2 className=\"text-xl font-semibold text-white mb-2\">6. 個人情報の安全管理措置</h2>\n            <p>\n              当社は、個人情報の漏えい、滅失、毀損、不正アクセス等を防止するため、以下の安全管理措置を講じます。\n            </p>\n            <ul className=\"list-disc list-inside ml-4 mt-2 space-y-1\">\n              <li>個人情報管理責任者の設置</li>\n              <li>個人情報の利用制限とアクセス権限の管理</li>\n              <li>パスワードや暗号化等の技術的対策</li>\n              <li>社員教育や内部監査の実施</li>\n              <li>保管期限を過ぎた個人情報の適切な廃棄・消去</li>\n            </ul>\n          </section>\n\n          <section>\n            <h2 className=\"text-xl font-semibold text-white mb-2\">7. クッキー（Cookie）およびローカルストレージ等の利用</h2>\n            <p>\n              当社ウェブサイトおよび会員マイページでは、利便性向上やアクセス解析等のために Cookie や類似技術を使用する場合があります。\n              これにより取得される情報は、個人を特定するものではなく、設定により使用を制限できます。必要に応じて、Google Analytics 等の外部サービスを利用することがあります。\n            </p>\n            <p className=\"mt-2\">\n              また、会員マイページにおいては、ログイン状態の保持、表示設定の保存、利用状況の記録等のために、ブラウザの\n              ローカルストレージ（LocalStorage・SessionStorage）を利用する場合があります。ローカルストレージに保存される情報は、\n              利用者の端末上でのみ保持され、当社サーバーに自動的に送信されることはありません。\n            </p>\n            <p className=\"mt-2\">\n              利用者は、ご自身のブラウザ設定により、Cookieやローカルストレージの使用を制限または削除することができます。ただし、\n              その場合、会員マイページの一部機能が正しく利用できない可能性があります。\n            </p>\n          </section>\n\n          <section>\n            <h2 className=\"text-xl font-semibold text-white mb-2\">8. 個人情報の開示・訂正・利用停止等</h2>\n            <p>\n              本人または代理人から、当社が保有する個人情報の開示・訂正・追加・削除・利用停止・第三者提供停止の請求があった場合は、\n              法令に従い適切かつ速やかに対応します。請求の際には、本人確認のための書類提出をお願いする場合があります。\n            </p>\n          </section>\n\n          <section>\n            <h2 className=\"text-xl font-semibold text-white mb-2\">9. 未成年の会員情報について</h2>\n            <p>\n              16歳未満の方が会員登録を行う場合は、必ず保護者の同意を得てください。当社は、保護者の同意が確認できない場合、\n              会員サービスを提供できないことがあります。\n            </p>\n          </section>\n\n          <section>\n            <h2 className=\"text-xl font-semibold text-white mb-2\">10. 法令・規範の遵守</h2>\n            <p>\n              当社は、個人情報の取扱いに関して適用される法令、国が定める指針、その他の規範を遵守します。\n            </p>\n          </section>\n\n          <section>\n            <h2 className=\"text-xl font-semibold text-white mb-2\">11. 継続的改善</h2>\n            <p>\n              当社は、個人情報保護のための管理体制や取組を継続的に見直し、改善します。\n            </p>\n          </section>\n\n          <section>\n            <h2 className=\"text-xl font-semibold text-white mb-2\">12. お問い合わせ窓口</h2>\n            <p>\n              本方針および個人情報の取扱いに関するお問い合わせは、以下の窓口までお願いします。<br />\n              True Story【実話の物語】<br />\n              電話番号：090-9646-8942 （代表）<br />\n              メールアドレス：info@truestory.jp<br />\n              受付時間：平日 11:00〜19:00（土日祝・年末年始を除く）\n            </p>\n          </section>\n\n          <section>\n            <h2 className=\"text-xl font-semibold text-white mb-2\">13. 制定日・改訂日</h2>\n            <p>制定日：2025年08月01日<br />改訂日：2025年09月13日</p>\n          </section>\n        </div>\n        <div className=\"text-center mt-8 md:mt-12\">\n          <button onClick={onClose} className=\"bg-white text-black font-bold py-3 px-8 rounded-full hover:opacity-90 transition-opacity duration-300 text-lg\">\n            閉じる\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default PrivacyPolicy;\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 666, "column": 0}, "map": {"version":3,"sources":["file:///Users/tunotunofilms/Downloads/code/True%20Story/src/components/CookieConsent.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport PrivacyPolicy from './PrivacyPolicy';\n\nconst CookieConsent: React.FC = () => {\n  const [showBanner, setShowBanner] = useState(false);\n  const [showPrivacy, setShowPrivacy] = useState(false);\n\n  useEffect(() => {\n    const consent = localStorage.getItem('cookie_consent');\n    if (consent !== 'dismissed') {\n      setShowBanner(true);\n    }\n  }, []);\n\n  const handleDismiss = () => {\n    localStorage.setItem('cookie_consent', 'dismissed');\n    setShowBanner(false);\n  };\n\n  if (!showBanner) {\n    return null;\n  }\n\n  return (\n    <>\n      <div className=\"fixed bottom-0 left-0 right-0 bg-gray-800 text-white p-4 z-50\">\n        <div className=\"container mx-auto flex flex-col md:flex-row justify-between items-center gap-3\">\n          <p className=\"text-sm\">\n            当サイトでは、ログイン機能などサービスの提供に必須のCookieを使用しています。サイトの利用を継続することで、これらのCookieの使用に同意したものとみなされます。\n            詳細は\n            <button\n              type=\"button\"\n              onClick={() => setShowPrivacy(true)}\n              className=\"underline ml-1\"\n            >\n              プライバシーポリシー\n            </button>\n            をご確認ください。\n          </p>\n          <div className=\"flex items-center gap-3\">\n            <button\n              onClick={handleDismiss}\n              className=\"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded\"\n              aria-label=\"閉じる\"\n            >\n              OK\n            </button>\n          </div>\n        </div>\n      </div>\n      {showPrivacy && <PrivacyPolicy onClose={() => setShowPrivacy(false)} />}\n    </>\n  );\n};\n\nexport default CookieConsent;\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAEA,MAAM,gBAA0B;IAC9B,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAC;IAC7C,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAE/C,IAAA,kNAAS,EAAC;QACR,MAAM,UAAU,aAAa,OAAO,CAAC;QACrC,IAAI,YAAY,aAAa;YAC3B,cAAc;QAChB;IACF,GAAG,EAAE;IAEL,MAAM,gBAAgB;QACpB,aAAa,OAAO,CAAC,kBAAkB;QACvC,cAAc;IAChB;IAEA,IAAI,CAAC,YAAY;QACf,OAAO;IACT;IAEA,qBACE;;0BACE,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAE,WAAU;;gCAAU;8CAGrB,8OAAC;oCACC,MAAK;oCACL,SAAS,IAAM,eAAe;oCAC9B,WAAU;8CACX;;;;;;gCAEQ;;;;;;;sCAGX,8OAAC;4BAAI,WAAU;sCACb,cAAA,8OAAC;gCACC,SAAS;gCACT,WAAU;gCACV,cAAW;0CACZ;;;;;;;;;;;;;;;;;;;;;;YAMN,6BAAe,8OAAC,8IAAa;gBAAC,SAAS,IAAM,eAAe;;;;;;;;AAGnE;uCAEe","debugId":null}},
    {"offset": {"line": 763, "column": 0}, "map": {"version":3,"sources":["file:///Users/tunotunofilms/Downloads/code/True%20Story/src/components/Header.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { useRouter, usePathname } from 'next/navigation';\nimport { supabase } from '../lib/supabaseClient';\nimport { Menu, X } from 'lucide-react';\nimport CookieConsent from './CookieConsent';\nimport { useAuth } from '../contexts/AuthContext';\n\ninterface Vote {\n  message: string | null;\n  voter_name: string | null;\n}\n\ninterface NavItem {\n  id?: string;\n  path?: string;\n  label: string;\n}\n\nconst Header: React.FC = () => {\n  const router = useRouter();\n  const pathname = usePathname();\n  const { session } = useAuth();\n  const isLoggedIn = !!session;\n\n  const [latestVotes, setLatestVotes] = useState<Vote[]>([]);\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n  const animationRef = useRef<HTMLDivElement>(null);\n  const [applyWillChange, setApplyWillChange] = useState(false);\n  const [prefersReducedMotion, setPrefersReducedMotion] = useState(false);\n\n  const fetchLatestVotes = useCallback(async () => {\n    const { data, error } = await supabase\n      .from('votes')\n      .select('message, voter_name')\n      .order('created_at', { ascending: false });\n\n    if (error) {\n      console.error('Error fetching latest votes:', error);\n    } else {\n      setLatestVotes(data || []);\n    }\n  }, []);\n\n  useEffect(() => {\n    fetchLatestVotes();\n  }, [fetchLatestVotes]);\n\n  const handleAnimationIteration = () => {\n    fetchLatestVotes();\n  };\n\n  const scrollToSection = (sectionId: string) => {\n    if (pathname !== '/') {\n      router.push(`/#${sectionId}`);\n    } else {\n      const element = document.getElementById(sectionId);\n      if (element) {\n        element.scrollIntoView({ behavior: 'smooth' });\n      }\n    }\n  };\n\n  const handleMobileLinkClick = (sectionId: string) => {\n    scrollToSection(sectionId);\n    setIsMenuOpen(false);\n  };\n\n  const scrollToTop = () => {\n    if (pathname !== '/') {\n      router.push('/');\n    } else {\n      window.scrollTo({ top: 0, behavior: 'smooth' });\n    }\n  };\n\n  const navItems: NavItem[] = [\n    // { path: '/about', label: 'ABOUT' },\n    { id: 'truestoryform', label: 'TRUE STORY' },\n    { id: 'artist', label: 'ARTIST' },\n    { id: 'crowdfunding', label: 'CROWDFUNDING' },\n    { id: 'contact', label: 'CONTACT' },\n  ];\n\n  const handleMyPageClick = () => {\n    router.push('/users');\n  };\n\n  // ログイン中はマイページへ遷移、未ログイン時はメンバーシップへ\n  const handleAuthButtonClick = () => {\n    if (isLoggedIn) {\n      const userId = session?.user?.id;\n      if (userId) {\n        router.push(`/users/member/${userId}`);\n        return;\n      }\n      // fallback: メンバーシップ画面へ（session が取れない場合）\n      handleMyPageClick();\n    } else {\n      handleMyPageClick();\n    }\n  };\n\n  useEffect(() => {\n    const mq = window.matchMedia('(prefers-reduced-motion: reduce)');\n    const update = () => setPrefersReducedMotion(mq.matches);\n    update();\n    mq.addEventListener?.('change', update);\n    return () => mq.removeEventListener?.('change', update);\n  }, []);\n\n  useEffect(() => {\n    const el = animationRef.current;\n    if (!el) return;\n\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        setApplyWillChange(entry.isIntersecting && !prefersReducedMotion && latestVotes.length > 0);\n      },\n      { root: null, threshold: 0.1 }\n    );\n\n    observer.observe(el);\n    return () => observer.disconnect();\n  }, [latestVotes.length, prefersReducedMotion]);\n\n  return (\n    <>\n      <header className=\"sticky top-0 z-50\">\n        <nav className=\"bg-black\">\n          <div className=\"container mx-auto px-4\">\n            <div className=\"flex items-center justify-between h-16\">\n              <div\n                className=\"text-white font-noto text-xl font-bold cursor-pointer\"\n                onClick={scrollToTop}\n              >\n                True Story【実話の物語】\n              </div>\n              \n              <div className=\"hidden xl_custom:flex items-center space-x-4 md:space-x-8\">\n                {navItems.map((item) => (\n                  <button\n                    key={item.label}\n                    onClick={() => {\n                      if (item.path) {\n                        router.push(item.path);\n                      } else if (item.id) {\n                        scrollToSection(item.id);\n                      }\n                    }}\n                    className=\"text-neutral-300 hover:text-white transition duration-300 font-noto\"\n                  >\n                    {item.label}\n                  </button>\n                ))}\n                <button\n                  onClick={handleAuthButtonClick}\n                  className=\"text-white transition duration-300 font-noto px-2 py-1 border border-transparent hover:opacity-90\"\n                >\n                  <span className=\"inline-block bg-gradient-to-r from-emerald-500 to-teal-500 text-white font-bold py-2 px-4 rounded\">\n                   {isLoggedIn ? 'マイページ' : 'メンバーシップ'}\n                  </span>\n                </button>\n              </div>\n\n              <div className=\"xl_custom:hidden\">\n                <button onClick={() => setIsMenuOpen(!isMenuOpen)} className=\"text-white\">\n                  {isMenuOpen ? <X size={28} /> : <Menu size={28} />}\n                </button>\n              </div>\n            </div>\n          </div>\n\n          <div \n            className={`xl_custom:hidden bg-black/95 backdrop-blur-md absolute w-full z-40 shadow-lg border-t border-gray-700 transition-all duration-300 ease-in-out transform origin-top ${\n              isMenuOpen \n                ? 'opacity-100 scale-y-100 translate-y-0' \n                : 'opacity-0 scale-y-0 -translate-y-2 pointer-events-none'\n            }`}\n          >\n            <div className=\"container mx-auto px-4 pb-4\">\n              {navItems.map((item, index) => (\n                <div \n                  key={item.label}\n                  className={`transition-all duration-300 ease-in-out ${\n                    isMenuOpen \n                      ? 'opacity-100 translate-y-0' \n                      : 'opacity-0 translate-y-2'\n                  }`}\n                  style={{ \n                    transitionDelay: isMenuOpen ? `${index * 50}ms` : '0ms' \n                  }}\n                >\n                  <button\n                    onClick={() => {\n                      if (item.path) {\n                        router.push(item.path);\n                        setIsMenuOpen(false);\n                      } else if (item.id) {\n                        handleMobileLinkClick(item.id);\n                      }\n                    }}\n                    className=\"block w-full text-left py-4 px-4 text-neutral-300 hover:text-white hover:bg-gray-800/50 transition-all duration-300 font-noto rounded-md\"\n                  >\n                    {item.label}\n                  </button>\n                  {index < navItems.length - 1 && (\n                    <div className=\"border-b border-gray-700/50 mx-2\"></div>\n                  )}\n                </div>\n              ))}\n              <div \n                className={`transition-all duration-300 ease-in-out ${\n                  isMenuOpen \n                    ? 'opacity-100 translate-y-0' \n                    : 'opacity-0 translate-y-2'\n                }`}\n                style={{ \n                  transitionDelay: isMenuOpen ? `${navItems.length * 50}ms` : '0ms' \n                }}\n              >\n                <div className=\"border-b border-gray-700/50 mx-2\"></div>\n                <button\n                  onClick={() => {\n                    handleAuthButtonClick();\n                    setIsMenuOpen(false);\n                  }}\n                  className=\"block w-full text-left py-4 px-4 transition-all duration-300 font-noto mt-2\"\n                >\n                  <span className=\"inline-block bg-gradient-to-r from-emerald-500 to-teal-500 text-white font-bold py-2 px-4 rounded\">\n                    {isLoggedIn ? 'マイページ' : 'メンバーシップ'}\n                  </span>\n                </button>\n              </div>\n            </div>\n          </div>\n        </nav>\n\n        <div className=\"relative z-10 py-2 overflow-hidden isolate\">\n          <div\n            className=\"absolute inset-0 bg-gray-800/30 backdrop-blur-sm pointer-events-none\"\n            aria-hidden=\"true\"\n            style={{ backfaceVisibility: 'hidden', WebkitBackfaceVisibility: 'hidden' }}\n          />\n          <div className=\"container mx-auto px-6 md:px-12 relative\">\n            <div className=\"max-w-6xl mx-auto min-h-[44px]\">\n              {latestVotes.length > 0 && (\n                <div\n                  ref={animationRef}\n                  className=\"flex animate-scroll-left whitespace-nowrap text-white transform-gpu\"\n                  onAnimationIteration={handleAnimationIteration}\n                  style={{ willChange: applyWillChange ? 'transform' : undefined }}\n                >\n                  {latestVotes\n                    .filter(vote => vote.message && vote.message.trim() !== '')\n                    .map((vote, index) => (\n                      <div key={index} className=\"inline-flex items-center mx-8 flex-shrink-0\">\n                        <div className=\"text-left\">\n                          <p className=\"text-xs font-noto text-neutral-300\">\n                            {vote.voter_name || '匿名'}より\n                          </p>\n                          <p className=\"text-sm font-noto\">{vote.message}</p>\n                        </div>\n                      </div>\n                    ))}\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </header>\n      <CookieConsent />\n    </>\n  );\n};\n\nexport default Header;\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1191, "column": 0}, "map": {"version":3,"sources":["file:///Users/tunotunofilms/Downloads/code/True%20Story/src/components/Footer.tsx"],"sourcesContent":["import React from 'react';\n\ninterface FooterProps {\n  onShowPrivacyPolicy: () => void;\n}\n\nconst Footer: React.FC<FooterProps> = ({ onShowPrivacyPolicy }) => {\n  return (\n    <footer className=\"bg-black text-neutral-500 py-6 text-center text-xs\">\n      <div className=\"container mx-auto px-6\">\n        <button onClick={onShowPrivacyPolicy} className=\"hover:text-white transition-colors duration-300 mb-2\">\n          個人情報の取り扱いについて\n        </button>\n        <p>&copy; {new Date().getFullYear()} True Story. All Rights Reserved.</p>\n      </div>\n    </footer>\n  );\n};\n\nexport default Footer;"],"names":[],"mappings":";;;;;;AAMA,MAAM,SAAgC,CAAC,EAAE,mBAAmB,EAAE;IAC5D,qBACE,8OAAC;QAAO,WAAU;kBAChB,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAO,SAAS;oBAAqB,WAAU;8BAAuD;;;;;;8BAGvG,8OAAC;;wBAAE;wBAAQ,IAAI,OAAO,WAAW;wBAAG;;;;;;;;;;;;;;;;;;AAI5C;uCAEe","debugId":null}},
    {"offset": {"line": 1240, "column": 0}, "map": {"version":3,"sources":["file:///Users/tunotunofilms/Downloads/code/True%20Story/src/utils/authUtils.ts"],"sourcesContent":["import { supabase } from '../lib/supabaseClient';\n\nexport const generateYears = () => {\n  const currentYear = new Date().getFullYear();\n  const years = [];\n  for (let year = currentYear; year >= currentYear - 100; year--) {\n    years.push(year);\n  }\n  return years;\n};\n\nexport const generateMonths = () => {\n  return Array.from({ length: 12 }, (_, i) => i + 1);\n};\n\nexport const generateDays = (year?: string, month?: string) => {\n  if (!year || !month) return Array.from({ length: 31 }, (_, i) => i + 1);\n  \n  const lastDay = new Date(parseInt(year), parseInt(month), 0).getDate();\n  return Array.from({ length: lastDay }, (_, i) => i + 1);\n};\n\nexport const formatBirthDate = (year?: string, month?: string, day?: string) => {\n  if (!year || !month || !day) return '';\n  const formattedMonth = month.padStart(2, '0');\n  const formattedDay = day.padStart(2, '0');\n  return `${year}-${formattedMonth}-${formattedDay}`;\n};\n\nexport const calculatePasswordStrength = (password: string): { strength: number; message: string } => {\n  if (!password) return { strength: 0, message: '' };\n\n  let score = 0;\n  \n  if (password.length >= 8) score += 1;\n  if (password.length >= 12) score += 1;\n  if (/[A-Z]/.test(password)) score += 1;\n  if (/[a-z]/.test(password)) score += 1;\n  if (/[0-9]/.test(password)) score += 1;\n  if (/[^A-Za-z0-9]/.test(password)) score += 1;\n  \n  const normalizedScore = Math.min(3, Math.floor(score / 2));\n  \n  let message = '';\n  if (normalizedScore === 0) message = '弱いパスワード';\n  else if (normalizedScore === 1) message = '普通のパスワード';\n  else if (normalizedScore === 2) message = '強いパスワード';\n  else message = '非常に強いパスワード';\n  \n  return { strength: normalizedScore, message };\n};\n\nexport const checkMemberExists = async (userId: string) => {\n  try {\n    // まず個人ユーザーテーブルをチェック\n    const { data: individualMember } = await supabase\n      .from('individual_members')\n      .select('*')\n      .eq('auth_user_id', userId)\n      .limit(1)\n      .maybeSingle();\n\n    if (individualMember) {\n      return { ...individualMember, user_type: 'individual' };\n    }\n\n    // 次に企業ユーザーテーブルをチェック\n    const { data: sponsorMember } = await supabase\n      .from('sponsor_members')\n      .select('*')\n      .eq('auth_user_id', userId)\n      .limit(1)\n      .maybeSingle();\n\n    if (sponsorMember) {\n      return { ...sponsorMember, user_type: 'sponsor' };\n    }\n\n    return null;\n  } catch (error) {\n    console.error('Error in checkMemberExists:', error);\n    return null;\n  }\n};\n\nexport const getRedirectURL = () => {\n  // 1) ローカル開発用に明示的な env を優先（.env.local に設定してください）\n  if (typeof process !== 'undefined' && process?.env?.REACT_APP_SITE_URL) {\n    return String(process.env.REACT_APP_SITE_URL).replace(/\\/$/, '');\n  }\n\n  // 2) Next.js の process.env をチェック\n  if (typeof process !== 'undefined' && process?.env?.NEXT_PUBLIC_SITE_URL) {\n    return String(process.env.NEXT_PUBLIC_SITE_URL).replace(/\\/$/, '');\n  }\n\n  // 3) ブラウザ実行時かつローカルホストなら現在の origin を最優先（ポートも含む）\n  if (typeof window !== 'undefined' && window.location && window.location.hostname) {\n    const hostname = window.location.hostname;\n    const origin = String(window.location.origin).replace(/\\/$/, '');\n    if (\n      hostname.includes('localhost') ||\n      hostname.startsWith('127.') ||\n      hostname === '::1'\n    ) {\n      return origin;\n    }\n  }\n\n  // 4) 最後のフォールバックは本番URL\n  return 'https://www.truestory.jp';\n};\n\nexport const handleGoogleAuth = async () => {\n  const base = getRedirectURL();\n  const redirectTo = `${base.replace(/\\/$/, '')}/users`; // 認証後は /users に戻す\n\n  // デバッグログを強化：Supabase に渡す redirectTo を明示表示します\n  console.info('[authUtils] Google auth redirectTo ->', redirectTo);\n\n  try {\n    const { error } = await supabase.auth.signInWithOAuth({\n      provider: 'google',\n      options: {\n        redirectTo: redirectTo,\n        queryParams: {\n          prompt: 'select_account'\n        }\n      }\n    });\n\n    if (error) {\n      console.error('Google auth error:', error);\n    }\n  } catch (err) {\n    console.error('Unexpected error during Google auth:', err);\n  }\n};\n\n// 追加: 冗長なサインアウト処理を共通化\nexport const robustSignOut = async () => {\n  try {\n    const { error } = await supabase.auth.signOut();\n    if (error) {\n      console.warn('Supabase signOut returned error:', error);\n      // ここではエラーをそのまま続行してフォールバック処理へ進める\n    }\n  } catch (err) {\n    console.warn('Supabase signOut threw error:', err);\n    // 続行してフォールバック処理へ\n  } finally {\n    // localStorage はブラウザ環境でのみ利用可能なため、存在チェックを行う\n    if (typeof window !== 'undefined' && window.localStorage) {\n      try {\n        Object.keys(window.localStorage).forEach((k) => {\n          const key = String(k);\n          const lower = key.toLowerCase();\n          // supabase-js v2 uses keys like \"sb-<project_ref>-auth-token\"\n          // older versions used \"supabase.\" prefix. Remove either.\n          if (lower.startsWith('sb-') || lower.startsWith('supabase.')) {\n            window.localStorage.removeItem(key);\n          }\n        });\n      } catch (e) {\n        console.warn('Failed to clear supabase localStorage items.', e);\n      }\n    }\n\n    // The redirect fallback was removed because it was causing a 405 error\n    // by making a GET request to a POST-only endpoint.\n    // supabase.auth.signOut() should be sufficient.\n  }\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1397, "column": 0}, "map": {"version":3,"sources":["file:///Users/tunotunofilms/Downloads/code/True%20Story/src/app/users/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect } from 'react';\nimport Link from 'next/link';\nimport { useRouter } from 'next/navigation';\nimport { Users, Building } from 'lucide-react';\nimport Header from '../../components/Header';\nimport Footer from '../../components/Footer';\nimport PrivacyPolicy from '../../components/PrivacyPolicy';\nimport { supabase } from '../../lib/supabaseClient';\nimport { useAuth } from '../../contexts/AuthContext';\nimport { robustSignOut, checkMemberExists } from '../../utils/authUtils';\n\nconst MyPage: React.FC = () => {\n  const [showPrivacyPolicy, setShowPrivacyPolicy] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const router = useRouter();\n  const { session, loading: authLoading } = useAuth();\n\n  const openPrivacyPolicy = () => setShowPrivacyPolicy(true);\n  const closePrivacyPolicy = () => setShowPrivacyPolicy(false);\n\n  const handleSignOut = async () => {\n    console.log('handleSignOutがUser.tsxから呼び出されました。');\n    await robustSignOut();\n    router.push('/'); // サインアウト後はトップページへ\n  };\n\n  useEffect(() => {\n    const handleAuthCallback = async () => {\n      setIsLoading(true);\n\n      if (authLoading) {\n        console.log('User.tsx: AuthContextがまだ読み込まれています。待機中...');\n        return; // AuthContextがロードされるまで待機\n      }\n\n      // Supabaseの認証コールバックURLのハッシュを処理\n      try {\n        if (\n          typeof window !== 'undefined' &&\n          window.location.hash &&\n          (window.location.hash.includes('access_token') ||\n            window.location.hash.includes('error') ||\n            window.location.hash.includes('provider_token'))\n        ) {\n          console.log('User.tsx: URLハッシュから認証コールバックを処理中です。');\n          // Supabase-js v2 does not expose getSessionFromUrl; use getSession to obtain the current session instead\n          await supabase.auth.getSession(); // これによりセッションが処理される\n          // URLのハッシュを消してクリーンにする\n          window.history.replaceState({}, document.title, window.location.pathname + window.location.search);\n        }\n      } catch (e) {\n        console.error('User.tsx: Error handling auth callback hash:', e);\n      }\n\n      // セッションが確立された後にlocalStorageをチェック\n      const pendingSubmission = localStorage.getItem('pendingStorySubmission');\n      if (pendingSubmission && session?.user) { // セッションがあることも確認\n        // 個人会員情報が登録済みかチェック\n        const existingMember = await checkMemberExists(session.user.id);\n        if (existingMember && existingMember.user_type === 'individual') { // user_type を確認\n          localStorage.removeItem('pendingStorySubmission');\n          router.push('/#truestoryform');\n          return;\n        } else {\n          // 個人会員情報が未登録の場合は、追加情報フォームへリダイレクト\n          router.push(`/users/member/${session.user.id}`);\n          return;\n        }\n      }\n\n      if (session?.user) {\n        console.log('User.tsx: セッションユーザーが見つかりました。', session.user.id);\n        const currentUser = session.user;\n\n        // 個人会員情報をチェック\n        const { data: individualMember } = await supabase\n          .from('individual_members')\n          .select('*')\n          .eq('auth_user_id', currentUser.id)\n          .limit(1)\n          .maybeSingle();\n\n        if (individualMember) {\n          console.log('User.tsx: 個人会員が見つかりました。/users/member/にリダイレクトします。', individualMember.auth_user_id);\n          router.push(`/users/member/${individualMember.auth_user_id}`);\n          return;\n        }\n\n        // スポンサー会員情報をチェック\n        const { data: sponsorMember } = await supabase\n          .from('sponsor_members')\n          .select('*')\n          .eq('auth_user_id', currentUser.id)\n          .limit(1)\n          .maybeSingle();\n\n        if (sponsorMember) {\n          console.log('User.tsx: スポンサー会員が見つかりました。/users/sponsor/にリダイレクトします。', currentUser.id);\n          router.push(`/users/sponsor/${currentUser.id}`);\n          return;\n        }\n\n        // どちらの会員でもない場合\n        console.log('User.tsx: どの会員タイプにも一致しませんでした。');\n        setIsLoading(false);\n      } else {\n        console.log('User.tsx: セッションユーザーが見つかりません。');\n        setIsLoading(false);\n      }\n    };\n\n    handleAuthCallback();\n  }, [session, authLoading, router]);\n\n  if (isLoading || authLoading) {\n    return (\n      <div className=\"min-h-screen bg-neutral-900 text-white\">\n        <Header />\n        <main className=\"container mx-auto px-4 py-16\">\n          <div className=\"text-center\">\n            <h1 className=\"text-4xl font-bold font-noto mb-8\">マイページ</h1>\n            <div className=\"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto\"></div>\n            <p className=\"text-neutral-300 mt-4\">認証情報を確認中...</p>\n          </div>\n        </main>\n        <Footer onShowPrivacyPolicy={openPrivacyPolicy} />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-black text-white min-h-screen flex flex-col\">\n      <Header />\n      <main className=\"flex-grow pt-24 pb-16\">\n        <div className=\"container mx-auto px-6 text-center\">\n          <h1 className=\"text-3xl md:text-4xl font-bold mb-8 gradient-text\">\n            メンバーシップ\n          </h1>\n          <p className=\"text-neutral-300 mb-12 max-w-2xl mx-auto\">\n            True Story【実話の物語】のメンバーシップにご参加ください。\n          </p>\n\n          <div className=\"grid md:grid-cols-2 gap-8 max-w-4xl mx-auto\">\n            {/* 個人会員 */}\n            <Link href=\"/users/member\" className=\"card-link-wrapper\">\n              <div className=\"card-base bg-neutral-900 border border-neutral-700 rounded-lg p-8 h-full flex flex-col items-center justify-center transition-all duration-300 hover:border-emerald-500 hover:shadow-lg\">\n                <Users className=\"w-16 h-16 mb-4 text-emerald-400\" />\n                <h2 className=\"text-2xl font-bold mb-2 text-white\">個人会員</h2>\n                <p className=\"text-neutral-400\">\n                  実話を投稿したり、プロジェクトに参加できます。\n                </p>\n              </div>\n            </Link>\n\n            {/* スポンサー会員 */}\n            <Link href=\"/users/sponsor\" className=\"card-link-wrapper\">\n              <div className=\"card-base bg-neutral-900 border border-neutral-700 rounded-lg p-8 h-full flex flex-col items-center justify-center transition-all duration-300 hover:border-sky-500 hover:shadow-lg\">\n                <Building className=\"w-16 h-16 mb-4 text-sky-400\" />\n                <h2 className=\"text-2xl font-bold mb-2 text-white\">スポンサー会員</h2>\n                <p className=\"text-neutral-400\">\n                  プロジェクトを支援し、特典を受け取れます。\n                </p>\n              </div>\n            </Link>\n          </div>\n        </div>\n      </main>\n      <Footer onShowPrivacyPolicy={openPrivacyPolicy} />\n      {showPrivacyPolicy && <PrivacyPolicy onClose={closePrivacyPolicy} />}\n    </div>\n  );\n};\n\nexport default MyPage;\n"],"names":[],"mappings":"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","debugId":null}}]
}